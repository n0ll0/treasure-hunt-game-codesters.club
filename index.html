<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏴‍☠️ Treasure Hunt Adventure</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>

  <body>

    <main>
      <div class="game-container">
        <table class="game">
          <tr>
            <td class="button"></td>
            <td class="button"></td>
            <td class="button"></td>
          </tr>
          <tr>
            <td class="button"></td>
            <td class="button"></td>
            <td class="button"></td>
          </tr>
          <tr>
            <td class="button"></td>
            <td class="button"></td>
            <td class="button"></td>
          </tr>
        </table>
      </div>

      <p id="message">🏴‍☠️ Welcome, treasure hunter! Ready to find the gold? 🏴‍☠️</p>
      
      <div class="controls">
        <button class="control-btn" onclick="startNewGame()" start>⚓ Start New Adventure</button>
        <button class="control-btn instructions-btn" popovertarget="instructions" >📜 Instructions</button>
        <button class="control-btn dashboard-btn" popovertarget="dashboard" >📊 Dashboard</button>
        <button class="control-btn chart-btn" popovertarget="score-chart" >📈 Score chart</button>
      </div>

      <div id="instructions" popover="auto" class="instructions-panel">
        <h3>🗺️ How to Play</h3>
        <p>🏴‍☠️ Click on the circles to search for the hidden treasure!</p>
        <p>💰 Find the treasure in the fewest attempts to get a higher score!</p>
        <p>⭐ Score = 10 - (number of attempts)</p>
        <button popovertarget="instructions" popovertargetaction="hide">Got it!</button>
      </div>
      
      <div id="score-chart" popover="manual" class="chart-panel">
        <h3>📈 Score History</h3>
        <div id="stats"></div>
        <script>
          const container = document.getElementById('score-chart');
          function updateStatsSize() {
            const stats = document.getElementById('stats');
            if (!stats || !container) return;
            const rect = container.getBoundingClientRect();
            stats.style.width = Math.max(window.innerWidth < 540 ? 250 : 500, rect.width * 0.8) + 'px';
            stats.style.height = (window.innerHeight < 400 ? 300 : 380) + 'px';
            // Refresh Plotly chart if it exists
            if (window.Plotly && stats.children.length > 0) {
              Plotly.Plots.resize(stats);
            }
          }
          window.addEventListener('resize', updateStatsSize);
          container.addEventListener("toggle", updateStatsSize);
          updateStatsSize();
        </script>
        <button popovertarget="score-chart" popovertargetaction="hide">Close</button>
      </div>
      
      <div id="dashboard" popover="manual" class="dashboard-panel">
        <h3>📊 Treasure Hunter Dashboard</h3>
        
        <!-- Main Stats Cards -->
        <div class="stats-cards">
          <div class="stat-card total-score">
            <div class="stat-icon">💰</div>
            <div class="stat-content">
              <div class="stat-value" table-total>0</div>
              <div class="stat-label">Total Doubloons</div>
            </div>
          </div>
          
          <div class="stat-card games-played">
            <div class="stat-icon">🏴‍☠️</div>
            <div class="stat-content">
              <div class="stat-value" table-gameNr>0</div>
              <div class="stat-label">Expeditions</div>
            </div>
          </div>
          
          <div class="stat-card average-score">
            <div class="stat-icon">⭐</div>
            <div class="stat-content">
              <div class="stat-value" table-avg>0</div>
              <div class="stat-label">Avg. Haul</div>
            </div>
          </div>
          
          <div class="stat-card best-score">
            <div class="stat-icon">🏆</div>
            <div class="stat-content">
              <div class="stat-value" id="best-score">0</div>
              <div class="stat-label">Best Haul</div>
            </div>
          </div>
        </div>

        <!-- Achievement Badges -->
        <div class="achievements">
          <h4>🏆 Pirate Achievements</h4>
          <div class="badge-container">
            <div class="achievement-badge" id="perfect-shot-badge">
              <span class="badge-icon">🎯</span>
              <span class="badge-name">Perfect Shot</span>
              <span class="badge-count" id="perfect-shots">0</span>
            </div>
            <div class="achievement-badge" id="quick-draw-badge" popovertarget="quick-draw-hint" popovertargetaction="show">
              <span class="badge-icon">⚡</span>
              <span class="badge-name">Quick Draw</span>
              <span class="badge-count" id="quick-draws">0</span>
            </div>
            <span popover="hint" id="quick-draw-hint">Quick draawdwa</span>
            <div class="achievement-badge" id="treasure-master-badge">
              <span class="badge-icon">👑</span>
              <span class="badge-name">Treasure Master</span>
              <span class="badge-count" id="treasure-master">0</span>
            </div>
            <div class="achievement-badge" id="persistent-badge">
              <span class="badge-icon">🗡️</span>
              <span class="badge-name">Persistent</span>
              <span class="badge-count" id="persistent-count">0</span>
            </div>
          </div>
        </div>

        <!-- Leaderboard Style Recent Games -->
        <div class="recent-games">
          <h4>⚓ Recent Expeditions</h4>
          <div class="games-list" id="recent-games-list">
            <div class="no-games">🗺️ No expeditions yet, matey!</div>
          </div>
        </div>
        
        <button popovertarget="dashboard" popovertargetaction="hide">Close Dashboard</button>
        <button id="resetStatsBtn" popovertarget="reset-confirmation" class="reset-stats-btn">🔄 Reset All Stats</button>
      </div>
      
      <div id="reset-confirmation" popover class="confirmation-panel">
        <h3>⚠️ Confirm Reset</h3>
        <p>Are you sure you want to reset all your treasure hunting statistics?</p>
        <p><strong>This action cannot be undone!</strong></p>
        <div class="confirmation-buttons">
          <button onclick="resetGameStats()" class="confirm-btn">🔄 Yes, Reset Everything</button>
          <button popovertarget="reset-confirmation" popovertargetaction="hide" class="cancel-btn">❌ Cancel</button>
        </div>
      </div>
    </main>
    
    <script src="./gameScript.js"></script>
  </body>

</html>